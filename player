Player → ControlServer → 登入驗證 → Lobby
                          ↓
           get GameServer 狀態
                          ↓
           玩家選擇 GameServer → join_server
                          ↓
           GameServer：
                - ready_players
                - spectator_players
                - 心跳 + status_update → ControlServer

          ControlServer：
                - 監控 GameServer 延遲 / 健康
                - 控制玩家多端登入檢查
                - 通知 GameServer 踢人（kick player）

 改用 WSS + token 機制
 ControlServer 偵測 GameServer 延遲 + 健康狀態
 玩家登入 → 大廳 → 自選 GameServer
 玩家多端登入處理（踢原線 / 阻擋）
 GameServer 要有 Ready / 觀戰 機制
 大廳顯示 GameServer 狀態 + icon + 人數
 前端加玩法說明頁

 1️⃣ 傳輸驗證 / 加密機制
你目前用的是 ws:// → 沒加密 → 是 WebSocket 明文通訊

他說的 "WWS" 其實應該是 "WSS" → wss:// → WebSocket Secure (加密 WebSocket)
→ 等於 WebSocket over TLS（像 HTTPS）

你要換成 wss:// 必須先在 ControlServer + GameServer 加 TLS 憑證（可以先用 self-signed 憑證測試）

基本建議：

開發階段先用 ws://，正式版換 wss://

加簽驗證 token → 玩家登入後發一組 token，後續 ws 要帶 token 驗證（避免非法連線）

實作機制
玩家 login 時 ControlServer 回 token

client 後續建立 ws 時發 token

GameServer / ControlServer 驗證 token

2️⃣ 玩家連線異常 / 延遲 / 掛掉判斷
ControlServer
heartbeat_checker 已有 → 但目前只是判斷 last_heartbeat 超過 5 秒標記斷線

可以擴充：

紀錄每台 GameServer 最近一次 status_update 的 delay（延遲）

當 delay 過大 → 加入 warning 狀態

提供給 Lobby 顯示：「這台 server 延遲高」「這台 server 掛掉」

GameServer
status_update 裡多帶一個 server_time 或 seq，讓 ControlServer 判 delay

3️⃣ 玩家登入系統 + 大廳 + 手動選擇 GameServer
新流程
1️⃣ 玩家 login → 登入成功後 → 進入 Lobby（不是直接分配 GameServer）
2️⃣ Lobby 畫面 → 顯示當前所有 GameServer 狀態：
- Server 名稱
- 人數
- 遊戲階段（waiting/loading/playing）
- 延遲狀態（健康/延遲高/斷線）
- icon 顯示
3️⃣ 玩家手動點擊要進入哪台 GameServer
4️⃣ ControlServer 收到玩家選擇 → 發 join_server 訊息 → 紀錄 player_online_status
5️⃣ GameServer 需要有「玩家進入準備區（Ready）→ 開始遊戲」邏輯

4️⃣ 同一帳號多端登入處理
帳號鎖定設計

玩家進入 GameServer 時 → ControlServer 記錄該玩家在哪台 GameServer

如果同帳號在別處登入 → 必須：

阻擋登入，告知玩家已在線

或是允許登入，並通知原 GameServer 該玩家已被踢出 → GameServer 要處理 "kick player" 機制

前端收到 kick → 顯示「您的帳號在別處登入，您已被踢出該場遊戲」

通知流程
ControlServer 通知原 GameServer → GameServer 主動斷玩家 ws + 通知玩家被踢出

5️⃣ 遊戲玩法說明
前端加一個「Help / 說明」按鈕

點擊後顯示玩法說明頁

6️⃣ Lobby 顯示 GameServer 狀態 + icon
GameServer status_update 裡要帶：

current_players

game_phase

delay/health_status（由 ControlServer heartbeat_checker 判定）

前端 Lobby 用來顯示 GameServer 列表 + 狀態 icon

7️⃣ Ready / 觀戰機制
玩家進入 GameServer → 分為兩種狀態
Ready → 等下一局時選擇 Ready 才會進入遊戲

觀戰 → 觀看目前進行中的局，不參與本局

流程建議
玩家進入 GameServer → 初始是觀戰狀態

可以按 Ready → 變成準備進入下局

GameServer 需要維護兩個列表：

ready_players

spectator_players

遊戲開始時只將 ready_players 進入 playing